C51 COMPILER V9.53.0.0   PID                                                               09/13/2016 13:39:29 PAGE 1   


C51 COMPILER V9.53.0.0, COMPILATION OF MODULE PID
OBJECT MODULE PLACED IN .\src\PID.OBJ
COMPILER INVOKED BY: c:\SiliconLabs\SimplicityStudio\v3\developer\toolchains\keil_8051\9.53\BIN\C51.exe C:\Users\clfilho
                    -\SimplicityStudio\v3_workspace\myProject\src\PID.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3
                    -) OPTIMIZE(8,SPEED) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:/Users/clfilho/SimplicityStudio/v3_workspace/myProject/inc;C:/
                    -SiliconLabs/SimplicityStudio/v3/developer/sdks/si8051/v3//Device/shared/si8051Base;C:/SiliconLabs/SimplicityStudio/v3/de
                    -veloper/sdks/si8051/v3//Device/EFM8BB3;C:/SiliconLabs/SimplicityStudio/v3/developer/sdks/si8051/v3//Device/EFM8BB3/inc) 
                    -PRINT(.\src\PID.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\PID.OBJ)

line level    source

   1          //-----------------------------------------------------------------------------
   2          // PID.c
   3          //-----------------------------------------------------------------------------
   4          // Copyright 2016, Silicon Laboratories, Inc.
   5          // http://www.silabs.com
   6          //
   7          // Created on: Sept 2016
   8          //     Author: Claudio Filho
   9          //
  10          // PID controller for EFM8
  11          //
  12          //-----------------------------------------------------------------------------
  13          
  14          #include <SI_EFM8BB3_Register_Enums.h>
  15          
  16          
  17          //Constants
  18          
  19          #define errorlimitH 0x00
  20          #define errorlimitL 0x00
  21          
  22          #define setPoint        0x00
  23          
  24          #define Kp 0x0003
  25          #define Ki 0x0000
  26          #define Kd 0x0000
  27          
  28          
  29          //Static Variables
  30          
  31          
  32          static int8_t error;
  33          static int8_t n1_error =0;
  34          static int8_t P_term;
  35          static int8_t I_term;
  36          static int8_t D_term;
  37          static int16_t PIDresult;
  38          
  39          
  40          
  41          uint16_t CalculatePID(uint16_t current_error)
  42          {
  43   1              //Scale goes from 0 to 4095
  44   1      
  45   1      
  46   1              error = setPoint - current_error;
  47   1      
  48   1              if(error>errorlimitH)
  49   1              {
  50   2                      error = errorlimitH;
  51   2              }
C51 COMPILER V9.53.0.0   PID                                                               09/13/2016 13:39:29 PAGE 2   

  52   1      
  53   1              if(error<errorlimitL)
  54   1              {
  55   2                      error = errorlimitL;
  56   2              }
  57   1      
  58   1              P_term = (error*Kp)>>8;
  59   1      
  60   1              I_term += (error*Ki)>>8; //This I term may have to be desaturated (anti - windup).
  61   1      
  62   1              D_term = (n1_error *Kd)>>8;
  63   1      
  64   1              PIDresult = P_term + I_term + D_term;
  65   1      
  66   1              return PIDresult;
  67   1      }
  68          
  69          void SetDACOutput(uint16_t value)
  70          {
  71   1              SFRPAGE = 0x30;
  72   1      
  73   1              DAC0L = value;
  74   1              DAC0H= value >>8;
  75   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     98    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
